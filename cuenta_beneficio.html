<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribución de Beneficios - Generador</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<style>
:root{
  --bg:#f2f2f2;
  --card:#ffffff;
  --accent:#4CAF50;
  --muted:#666;
  --text:#111;
  --border:#ccc;
}
body{
  font-family: Arial, sans-serif;
  margin:0;
  background-color:var(--bg);
  color:var(--text);
}
.wrap{max-width:820px;margin:18px auto;padding:16px}
h1{font-size:20px;color:var(--accent);margin:0}
.controls, .output{
  background:var(--card);
  border-radius:10px;
  padding:14px;
  margin-top:12px;
  border:1px solid var(--border);
}
label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
input, select{width:100%;padding:10px;border-radius:6px;border:1px solid var(--border);box-sizing:border-box;font-size:14px;background:var(--card);color:var(--text);}
input::placeholder{color:#aaa;font-style:italic;}
.row {display:flex;gap:10px;flex-wrap:wrap}
.col{flex:1;min-width:160px}
.btn {display:inline-block;padding:9px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600;transition:0.2s;}
.btn-green{background:#4CAF50;color:#ffffff}
.btn-red{background:#f44336;color:#fff}
.btn-ghost{background:#eee;color:#111}
.btn:hover{opacity:0.85;}
.socios-list{margin-top:10px;display:flex;flex-direction:column;gap:8px}
.socio-item{display:flex;gap:8px;align-items:center;position:relative}
.partida {margin-top:14px;padding:12px;border-radius:8px;background-color: var(--card);border:1px solid rgba(0,0,0,0.08);}
.part-title{font-weight:700;color:var(--accent);margin-bottom:8px}
.line{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px dashed var(--border);}
.left{flex:2;font-size:14px}
.mid{flex:1;text-align:right;padding-right:8px;color:var(--text)}
.right{flex:1;text-align:right;color:var(--text)}
.line.no-border{border-bottom:0}
.registro{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);font-weight:400;}
.muted-block{font-size:13px;color:var(--muted);margin-top:6px}
footer{margin-top:18px;text-align:center;color:#666;font-size:13px}

/* Modo oscuro celeste */
body.dark{
  --bg:#121317;
  --card:#1e1f24;
  --accent:#00d8ff;
  --muted:#aaaaaa;
  --text:#e7eef0;
  --border:#444;
}
body.dark input, body.dark select{background:var(--card);color:var(--text);border:1px solid #555;}
body.dark .controls, body.dark .output{background:var(--card);border:1px solid var(--border);}
body.dark .partida{background-color: var(--card);border:1px solid #555;color:var(--text);}
body.dark .line{border-bottom:1px dashed #555;}
body.dark .registro{border-top:1px solid #555}
</style>
</head>
<body>
<div class="wrap">
  <h1>Distribución de Beneficios - Generador</h1>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
    <button class="btn btn-ghost" onclick="toggleDark()">Modo oscuro</button>
    <button class="btn btn-ghost" onclick="mostrarAyuda()">Ayuda</button>
    <button class="btn btn-green" onclick="descargarPDF()">Descargar PDF</button>
  </div>

  <section class="controls">
    <div class="row">
      <div class="col">
        <label>Ganancia antes de impuestos y reserva</label>
        <input id="gananciaAntes" type="number" min="0" step="0.01">
      </div>
      <div class="col">
        <label>% ISR a aplicar</label>
        <input id="porcISR" type="number" min="0" max="100" step="0.01" value="25">
      </div>
      <div class="col">
        <label>% Reserva legal</label>
        <input id="porcReserva" type="number" min="0" max="100" step="0.01" value="5">
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <div style="flex:1;min-width:220px">
        <label>Número de socios</label>
        <input id="numSocios" type="number" min="1" value="2">
        <div class="muted-block">Pulsa <strong>Generar campos</strong> para crear inputs por socio</div>
      </div>
      <div style="flex:1;min-width:220px">
        <label>Medio de pago</label>
        <select id="medioPago">
          <option value="Caja y Bancos">Caja y Bancos</option>
          <option value="Mercaderías">Mercaderías</option>
          <option value="Otros">Otros</option>
        </select>
      </div>
      <div style="min-width:180px;display:flex;gap:8px;align-items:flex-end">
        <button class="btn btn-green" onclick="crearCamposSocios()">Generar campos</button>
      </div>
    </div>

    <div class="socios-list" id="sociosList"></div>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <button class="btn btn-green" onclick="calcularYGenerar()">Calcular y Generar Partidas</button>
    </div>
  </section>

  <section class="output" id="salida"></section>
  <footer>Pagina creada por yo? | Derechos reservados</footer>
</div>

<script>
let socios=[];

function fmt(n){return Number(n).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});}

function crearCamposSocios(){
  const n = Math.max(1, parseInt(document.getElementById('numSocios').value || 1));
  socios=[];
  const container=document.getElementById('sociosList');
  container.innerHTML='';
  for(let i=0;i<n;i++){
    const div=document.createElement('div');
    div.className='socio-item';
    const inp=document.createElement('input');
    inp.type='text';
    inp.placeholder=`Nombre del socio ${i+1}`;
    div.appendChild(inp);
    container.appendChild(div);
  }
}

function calcularYGenerar(){
  const gananciaAntes=Number(document.getElementById('gananciaAntes').value||0);
  const porcISR=Number(document.getElementById('porcISR').value||25)/100;
  const porcReserva=Number(document.getElementById('porcReserva').value||5)/100;
  const medioPago=document.getElementById('medioPago').value;
  const sociosInputs=document.querySelectorAll('#sociosList input');
  socios=[];
  sociosInputs.forEach(inp=>socios.push({nombre:inp.value||inp.placeholder}));

  if(gananciaAntes<=0 || socios.length===0){alert('Ingresa valores válidos'); return;}
  const montoISR=gananciaAntes*porcISR;
  const montoReserva=gananciaAntes*porcReserva;
  const gananciaNeta=gananciaAntes-montoISR-montoReserva;
  const porSocio=gananciaNeta/socios.length;

  const salida=document.getElementById('salida');
  salida.innerHTML='';

  // Partida 1
  const part1=document.createElement('div'); part1.className='partida';
  const totalDebe1=gananciaAntes;
  const totalHaber1=montoISR+montoReserva+gananciaNeta;
  part1.innerHTML=`<div class="part-title">Partida 1:</div>
    <div class="line"><div class="left">Ganancia antes de impuesto y reserva</div><div class="mid">${fmt(gananciaAntes)}</div><div class="right"></div></div>
    <div class="line"><div class="left">a: ISR por pagar (${(porcISR*100).toFixed(2)}%)</div><div class="mid"></div><div class="right">${fmt(montoISR)}</div></div>
    <div class="line"><div class="left">a: Reserva legal (${(porcReserva*100).toFixed(2)}%)</div><div class="mid"></div><div class="right">${fmt(montoReserva)}</div></div>
    <div class="line no-border"><div class="left">a: Ganancia después de impuesto y reserva</div><div class="mid"></div><div class="right">${fmt(gananciaNeta)}</div></div>
    <div class="line registro"><div class="left">Registro del cálculo de ISR y reserva legal según lo establece la ley</div><div class="mid">${fmt(totalDebe1)}</div><div class="right">${fmt(totalHaber1)}</div></div>`;
  salida.appendChild(part1);

  // Partida 2
  const part2=document.createElement('div'); part2.className='partida';
  const totalDebe2=gananciaNeta;
  const totalHaber2=porSocio*socios.length;
  part2.innerHTML=`<div class="part-title">Partida 2:</div>
    <div class="line"><div class="left">Ganancia después de impuesto y reserva</div><div class="mid">${fmt(gananciaNeta)}</div><div class="right"></div></div>`;
  socios.forEach(s=>{
    const row=document.createElement('div'); row.className='line no-border';
    row.innerHTML=`<div class="left">a: Cuenta beneficio socio ${s.nombre}</div><div class="mid"></div><div class="right">${fmt(porSocio)}</div>`;
    part2.appendChild(row);
  });
  part2.innerHTML+=`<div class="line registro"><div class="left">Registro de la distribución de las ganancias a los ${socios.length} socios de la empresa</div><div class="mid">${fmt(totalDebe2)}</div><div class="right">${fmt(totalHaber2)}</div></div>`;
  salida.appendChild(part2);

  // Partida 3
  const part3=document.createElement('div'); part3.className='partida';
  const totalDebe3=0;
  const totalHaber3=porSocio*socios.length;
  part3.innerHTML=`<div class="part-title">Partida 3:</div>`;
  socios.forEach(s=>{
    const r=document.createElement('div'); r.className='line';
    r.innerHTML=`<div class="left">Cuenta beneficio socio ${s.nombre}</div><div class="mid">${fmt(porSocio)}</div><div class="right"></div>`;
    part3.appendChild(r);
  });
  const medioRow=document.createElement('div'); medioRow.className='line no-border';
  medioRow.innerHTML=`<div class="left">a: ${medioPago}</div><div class="mid"></div><div class="right">${fmt(totalHaber3)}</div>`;
  part3.appendChild(medioRow);
  part3.innerHTML+=`<div class="line registro"><div class="left">Registro del pago de ganancias a los ${socios.length} socios de la empresa</div><div class="mid">${fmt(totalDebe3)}</div><div class="right">${fmt(totalHaber3)}</div></div>`;
  salida.appendChild(part3);
}

function toggleDark(){document.body.classList.toggle('dark');}
function mostrarAyuda(){alert("Instrucciones:\n1. Ingresa la ganancia antes de impuestos y reserva.\n2. Ajusta ISR y Reserva legal si deseas.\n3. Ingresa el número de socios y pulsa Generar campos.\n4. Escribe el nombre de cada socio.\n5. Selecciona medio de pago.\n6. Pulsa Calcular y Generar Partidas.\n7. Pulsa Descargar PDF para obtener el archivo.");}
function descargarPDF(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.setFontSize(14); doc.text("Partidas Contables",105,10,null,null,'center');
  let y=15;
  const partidas=document.querySelectorAll('.partida');
  partidas.forEach(p=>{
    const title=p.querySelector('.part-title').textContent;
    doc.setFontSize(12); doc.text(title,10,y); y+=6;
    const body=[];
    const lines=p.querySelectorAll('.line');
    lines.forEach(l=>{
      const left=l.querySelector('.left')?.textContent||'';
      const mid=l.querySelector('.mid')?.textContent||'';
      const right=l.querySelector('.right')?.textContent||'';
      body.push([left,mid,right]);
    });
    doc.autoTable({startY:y,head:[["Cuenta","Debe","Haber"]],body:body,theme:'grid',styles:{cellPadding:2,fontSize:10}});
    y=doc.lastAutoTable.finalY+6;
  });
  doc.save("partidas.pdf");
}

</script>
</body>
</html>
